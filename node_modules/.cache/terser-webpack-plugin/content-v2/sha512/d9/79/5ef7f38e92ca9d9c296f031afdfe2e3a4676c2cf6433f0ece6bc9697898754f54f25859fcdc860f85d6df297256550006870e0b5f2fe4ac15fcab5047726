{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-f2955216\"],{\"094b\":function(e,t,n){},2654:function(e,t,n){\"use strict\";var i=n(\"094b\"),o=n.n(i);o.a},\"2cdc\":function(e,t,n){},\"2df4\":function(e,t,n){\"use strict\";var i=n(\"2cdc\"),o=n.n(i);o.a},\"38f6\":function(e,t,n){\"use strict\";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",[n(\"flowMain\")],1)},o=[],l=n(\"e193\"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",{staticClass:\"appcontainer\"},[n(\"div\",{staticClass:\"flow-menu\"},[e._l(e.menueList,(function(t){return n(\"div\",{key:t.id,staticClass:\"menu-item\",attrs:{draggable:\"true\"},on:{dragstart:function(n){return e.drag(t)}}},[n(\"i\",{class:t.icon}),n(\"div\",[e._v(e._s(t.name))])])})),n(\"hr\"),n(\"div\",{staticClass:\"menu-item\",on:{click:function(t){e.isConnect=!0}}},[n(\"i\",{staticClass:\"el-icon-bottom-right\"}),n(\"div\",[e._v(\"连线\")])]),n(\"div\",{staticClass:\"menu-item\",on:{click:function(t){e.isConnect=!1}}},[n(\"i\",{staticClass:\"el-icon-rank\"}),n(\"div\",[e._v(\"选择\")])])],2),n(\"div\",{staticClass:\"flow-detail\"},[n(\"div\",{ref:\"flowContent\",attrs:{id:\"flowContent\"},on:{drop:function(t){return e.drop(t)},dragover:function(t){return e.allowDrop(t)},click:function(t){return e.editFlow()},dblclick:function(t){e.isConnect=!1}}},e._l(e.data.nodeList,(function(t){return n(\"flowNode\",{key:t.id,attrs:{node:t,id:t.id,isconnect:e.isConnect},on:{\"delete-node\":e.deleteNode,\"change-node-site\":e.changeNodeSite,\"edit-node\":e.editNode}})})),1),n(\"div\",{staticClass:\"savebtn\"},[n(\"el-button\",{attrs:{type:\"primary\",size:\"mini\"},on:{click:function(t){return e.saveData()}}},[e._v(\"保 存\")])],1)]),n(\"div\",{staticClass:\"flow-edit\"},[n(\"div\",{staticClass:\"flow-edit-content\"},[n(\"edit-flow\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"flow\"==e.editType,expression:\"editType=='flow'\"}],ref:\"flowEdit\"}),n(\"edit-node\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"node\"==e.editType,expression:\"editType=='node'\"}],ref:\"nodeForm\"}),n(\"edit-line\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"line\"==e.editType,expression:\"editType=='line'\"}],ref:\"lineForm\",on:{\"line-save\":e.lineLabelSave}})],1)])])},s=[],r=(n(\"4de4\"),n(\"4160\"),n(\"a15b\"),n(\"a434\"),n(\"c0b6\"),n(\"b0c0\"),n(\"159b\"),n(\"4795\"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",{ref:\"node\",staticClass:\"node-item\",style:e.flowNodeContainer,on:{mouseenter:e.showDelete,mouseleave:e.hideDelete,mouseup:e.changeNodeSite,click:function(t){return t.stopPropagation(),e.editNode(t)}}},[n(\"div\",{staticClass:\"node-con\"},[n(\"i\",{staticClass:\"type-icon\",class:e.iconClass}),n(\"span\",[e._v(e._s(e.node.label))])]),n(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.mouseEnter,expression:\"mouseEnter\"}],staticClass:\"node-del\",on:{click:function(t){return t.stopPropagation(),e.deleteNode(t)}}},[n(\"i\",{staticClass:\"el-icon-circle-close\"})]),n(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.isconnect,expression:\"isconnect\"}],staticClass:\"flow-node-drag\"})])}),c=[],d={props:{node:Object,isconnect:Boolean},data:function(){return{mouseEnter:!1}},computed:{flowNodeContainer:{get:function(){return{position:\"absolute\",minWidth:\"80px\",top:this.node.top,left:this.node.left,boxShadow:this.mouseEnter?\"#66a6e0 0px 0px 12px 0px\":\"\"}}},iconClass:function(){return 1==this.node.Type?\"el-icon-help\":2==this.node.Type?\"el-icon-s-help\":3==this.node.Type?\"el-icon-user\":4==this.node.Type?\"el-icon-s-tools\":void 0}},methods:{deleteNode:function(){this.$emit(\"delete-node\",this.node.id)},editNode:function(){this.$emit(\"edit-node\",this.node.id)},showDelete:function(){this.mouseEnter=!0},hideDelete:function(){this.mouseEnter=!1},changeNodeSite:function(){this.$emit(\"changeNodeSite\",{nodeId:this.node.id,left:this.$refs.node.style.left,top:this.$refs.node.style.top})}}},u=d,f=(n(\"2654\"),n(\"2877\")),m=Object(f[\"a\"])(u,r,c,!1,null,null,null),h=m.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"el-form\",{ref:\"dataForm\",staticClass:\"flowEditForm margin13\",attrs:{model:e.flowData,\"label-width\":\"100px\",size:\"mini\"}},[n(\"el-form-item\",{attrs:{label:\"GUID\"}},[n(\"el-input\",{attrs:{disabled:\"\"},model:{value:e.flowData.Id,callback:function(t){e.$set(e.flowData,\"Id\",t)},expression:\"flowData.Id\"}})],1),n(\"el-form-item\",{attrs:{label:\"流程名称\"}},[n(\"el-input\",{model:{value:e.flowData.Name,callback:function(t){e.$set(e.flowData,\"Name\",t)},expression:\"flowData.Name\"}})],1),n(\"el-form-item\",{attrs:{label:\"备注\"}},[n(\"el-input\",{attrs:{type:\"textarea\",autosize:{minRows:2,maxRows:4}},model:{value:e.flowData.Remark,callback:function(t){e.$set(e.flowData,\"Remark\",t)},expression:\"flowData.Remark\"}})],1)],1)},b=[],v={name:\"editFlow\",data:function(){return{flowData:{}}},methods:{init:function(e){this.flowData=e}}},w=v,g=Object(f[\"a\"])(w,p,b,!1,null,null,null),x=g.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"el-form\",{ref:\"dataForm\",staticClass:\"flowEditForm margin13\",attrs:{model:e.node,\"label-width\":\"100px\",size:\"mini\"}},[n(\"el-form-item\",{attrs:{label:\"GUID\"}},[n(\"el-input\",{attrs:{disabled:\"\"},model:{value:e.node.id,callback:function(t){e.$set(e.node,\"id\",t)},expression:\"node.id\"}})],1),n(\"el-form-item\",{attrs:{label:\"名称\"}},[n(\"el-input\",{model:{value:e.node.label,callback:function(t){e.$set(e.node,\"label\",t)},expression:\"node.label\"}})],1),n(\"el-form-item\",{attrs:{label:\"活动类型\"}},[n(\"el-select\",{attrs:{placeholder:\"请选择\"},model:{value:e.node.Type,callback:function(t){e.$set(e.node,\"Type\",t)},expression:\"node.Type\"}},e._l(e.TypeList,(function(e){return n(\"el-option\",{key:e.Value,attrs:{label:e.Text,value:e.Value}})})),1)],1),n(\"el-form-item\",{attrs:{label:\"备注\"}},[n(\"el-input\",{attrs:{type:\"textarea\",autosize:{minRows:2,maxRows:4}},model:{value:e.node.Remark,callback:function(t){e.$set(e.node,\"Remark\",t)},expression:\"node.Remark\"}})],1)],1)},L=[],T={name:\"editNode\",data:function(){return{node:{},TypeList:[{Value:1,Text:\"起点\"},{Value:2,Text:\"终点\"},{Value:3,Text:\"人工活动\"},{Value:4,Text:\"自由活动\"}]}},methods:{init:function(e,t){var n=this;e.nodeList.filter((function(e){e.id===t&&(n.node=e)}))}}},y=T,C=Object(f[\"a\"])(y,k,L,!1,null,null,null),j=C.exports,$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"el-form\",{ref:\"dataForm\",staticClass:\"flowEditForm margin13\",attrs:{model:e.line,\"label-width\":\"100px\",size:\"mini\"}},[n(\"el-form-item\",{attrs:{label:\"GUID\"}},[n(\"el-input\",{attrs:{disabled:\"\"},model:{value:e.line.id,callback:function(t){e.$set(e.line,\"id\",t)},expression:\"line.id\"}})],1),n(\"el-form-item\",{attrs:{label:\"源活动\"}},[n(\"el-input\",{attrs:{disabled:\"\"},model:{value:e.line.from,callback:function(t){e.$set(e.line,\"from\",t)},expression:\"line.from\"}})],1),n(\"el-form-item\",{attrs:{label:\"目标活动\"}},[n(\"el-input\",{attrs:{disabled:\"\"},model:{value:e.line.to,callback:function(t){e.$set(e.line,\"to\",t)},expression:\"line.to\"}})],1),n(\"el-form-item\",{attrs:{label:\"名称\"}},[n(\"el-input\",{model:{value:e.line.label,callback:function(t){e.$set(e.line,\"label\",t)},expression:\"line.label\"}})],1),n(\"el-form-item\",{attrs:{label:\"备注说明\"}},[n(\"el-input\",{attrs:{type:\"textarea\",autosize:{minRows:2,maxRows:4}},model:{value:e.line.Remark,callback:function(t){e.$set(e.line,\"Remark\",t)},expression:\"line.Remark\"}})],1)],1)},D=[],E={name:\"editLine\",data:function(){return{line:{label:\"\"},isUpdate:!1}},watch:{line:{handler:function(e){this.isUpdate&&this.$emit(\"line-save\",this.line)},deep:!0}},methods:{init:function(e){this.isUpdate=!1,this.line=e,this.$nextTick((function(){this.isUpdate=!0}))}}},N=E,I=Object(f[\"a\"])(N,$,D,!1,null,null,null),P=I.exports,O={name:\"flowMain\",data:function(){return{menueList:[{type:1,name:\"起点\"},{type:2,name:\"终点\"}],jsPlumb:null,index:1,jsplumbSetting:{Anchors:[\"Top\",\"TopCenter\",\"TopRight\",\"TopLeft\",\"Right\",\"RightMiddle\",\"Bottom\",\"BottomCenter\",\"BottomRight\",\"BottomLeft\",\"Left\",\"LeftMiddle\"],Container:\"flowContent\",Connector:\"Straight\",ConnectionOverlays:[[\"Label\",{label:\"连线文本\",id:\"label-1\",cssClass:\"csslabel\"}]],ConnectionsDetachable:!1,DeleteEndpointsOnDetach:!1,Endpoint:[\"Rectangle\",{height:10,width:10}],EndpointStyle:{fill:\"rgba(255,255,255,0)\",outlineWidth:1},LogEnabled:!0,PaintStyle:{stroke:\"#409eff\",strokeWidth:2},Overlays:[[\"Arrow\",{width:8,length:8,location:1}]],RenderMode:\"svg\"},jsplumbConnectOptions:{isSource:!0,isTarget:!0,anchor:\"Continuous\"},jsplumbSourceOptions:{filter:\".flow-node-drag\",filterExclude:!1,anchor:\"Continuous\",allowLoopback:!1},jsplumbTargetOptions:{filter:\".flow-node-drag\",filterExclude:!1,anchor:\"Continuous\",allowLoopback:!1},loadEasyFlowFinish:!1,data:{flowInfo:{Id:this.getUUID(),Name:\"我的流程\",Remark:\"\"},nodeList:[],lineList:[]},currentItem:\"\",isConnect:!1,timer:null,currentConnect:\"\",currentLine:\"\",editType:\"\"}},components:{flowNode:h,editFlow:x,editNode:j,editLine:P},created:function(){},mounted:function(){var e=this;this.jsPlumb=l[\"jsPlumb\"].getInstance(),this.$nextTick((function(){e.init()})),this.editFlow()},methods:{init:function(){var e=this;this.jsPlumb.ready((function(){e.jsPlumb.importDefaults(e.jsplumbSetting),e.jsPlumb.setSuspendDrawing(!1,!0),e.loadEasyFlow(),e.jsPlumb.bind(\"click\",(function(t,n){console.log(\"click\",t),e.editLine(t),console.log(t.getOverlay(\"label-1\"))})),e.jsPlumb.bind(\"dblclick\",(function(t,n){clearTimeout(this.timer),console.log(\"dblclick\",t),e.$confirm(\"确定删除所点击的线吗?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then((function(){e.jsPlumb.deleteConnection(t)}))[\"catch\"]((function(){}))})),e.jsPlumb.bind(\"connection\",(function(t){console.log(\"connection\",t);var n=t.source.id,i=t.target.id;e.loadEasyFlowFinish&&e.data.lineList.push({from:n,to:i,label:\"连线名称\",id:e.getUUID(),Remark:\"\"}),setTimeout((function(){e.editLine(t.connection)}),100)})),e.jsPlumb.bind(\"connectionDetached\",(function(t){console.log(\"connectionDetached\",t),e.deleteLine(t.sourceId,t.targetId)})),e.jsPlumb.bind(\"connectionMoved\",(function(t){console.log(\"connectionMoved\",t),e.changeLine(t.originalSourceId,t.originalTargetId)})),e.jsPlumb.bind(\"contextmenu\",(function(e){console.log(\"contextmenu\",e)})),e.jsPlumb.bind(\"beforeDrop\",(function(t){console.log(\"beforeDrop\",t);var n=t.sourceId,i=t.targetId;return n===i?(e.$message.error(\"不能连接自己\"),!1):e.hasLine(n,i)?(e.$message.error(\"不能重复连线\"),!1):!e.hashOppositeLine(n,i)||(e.$message.error(\"不能回环哦\"),!1)})),e.jsPlumb.bind(\"beforeDetach\",(function(e){console.log(\"beforeDetach\",e)}))}))},loadEasyFlow:function(){for(var e=0;e<this.data.nodeList.length;e++){var t=this.data.nodeList[e];this.jsPlumb.makeSource(t.id,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(t.id,this.jsplumbTargetOptions),this.jsPlumb.draggable(t.id,{containment:\"parent\"})}for(e=0;e<this.data.lineList.length;e++){var n=this.data.lineList[e],i=this.jsPlumb.connect({source:n.from,target:n.to},this.jsplumbConnectOptions);i.getOverlay(\"label-1\").setLabel(n.label)}this.$nextTick((function(){this.loadEasyFlowFinish=!0}))},addNode:function(e){console.log(\"添加节点\",e),this.data.nodeList.push(e),this.$nextTick((function(){this.jsPlumb.makeSource(e.id,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(e.id,this.jsplumbTargetOptions),this.jsPlumb.draggable(e.id,{containment:\"parent\"})}))},deleteLine:function(e,t){this.data.lineList=this.data.lineList.filter((function(n){return n.from!==e&&n.to!==t}))},changeLine:function(e,t){this.deleteLine(e,t)},changeNodeSite:function(e){for(var t=0;t<this.data.nodeList.length;t++){var n=this.data.nodeList[t];n.id===e.nodeId&&(n.left=e.left,n.top=e.top)}},deleteNode:function(e){var t=this;return this.$confirm(\"确定要删除节点\"+e+\"?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",closeOnClickModal:!1}).then((function(){t.data.nodeList.forEach((function(n,i){n.id===e&&t.data.nodeList.splice(i,1)})),t.$nextTick((function(){console.log(\"删除\"+e),this.jsPlumb.removeAllEndpoints(e)}))}))[\"catch\"]((function(){})),!0},editNode:function(e){this.editType=\"node\",this.$nextTick((function(){this.$refs.nodeForm.init(this.data,e)}))},editLine:function(e){var t=this;t.currentConnect=e,t.data.lineList.forEach((function(n,i){if(n.from==e.sourceId&&n.to==e.targetId)return t.currentLine=n,t.editType=\"line\",void t.$nextTick((function(){t.$refs.lineForm.init(n)}))}))},delLine:function(e){var t=this;this.$confirm(\"确定删除所点击的线吗?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then((function(){t.jsPlumb.deleteConnection(e)}))[\"catch\"]((function(){}))},hasLine:function(e,t){for(var n=0;n<this.data.lineList.length;n++){var i=this.data.lineList[n];if(i.from===e&&i.to===t)return!0}return!1},hashOppositeLine:function(e,t){return this.hasLine(t,e)},lineLabelSave:function(e){this.currentConnect.getOverlay(\"label-1\").setLabel(e.label)},drag:function(e){this.currentItem=e},drop:function(e){this.$refs.flowContent;var t={id:this.getUUID(),label:this.currentItem.name,top:e.offsetY+\"px\",left:e.offsetX+\"px\",Type:this.currentItem.type};this.addNode(t),this.editNode(t.id)},allowDrop:function(e){e.preventDefault()},getUUID:function(){for(var e=[],t=\"0123456789abcdef\",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[14]=\"4\",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]=\"-\";var i=e.join(\"\");return i},saveData:function(){console.log(this.data)},editFlow:function(){this.editType=\"flow\",this.$nextTick((function(){this.$refs.flowEdit.init(this.data.flowInfo)}))}}},F=O,R=(n(\"2df4\"),Object(f[\"a\"])(F,a,s,!1,null,null,null)),_=R.exports,S={components:{flowMain:_},data:function(){return{}},methods:{}},U=S,B=Object(f[\"a\"])(U,i,o,!1,null,\"7affa246\",null);t[\"default\"]=B.exports}}]);","extractedComments":[]}